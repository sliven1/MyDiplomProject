// Database Schema Ğ´Ğ»Ñ "Ğ£Ñ‡ĞµĞ±Ğ° Ñ€ÑĞ´Ğ¾Ğ¼"
// Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: https://dbdiagram.io/

// ============================================
// ĞĞ¡ĞĞĞ’ĞĞ«Ğ• ĞšĞĞ›Ğ›Ğ•ĞšĞ¦Ğ˜Ğ˜
// ============================================

Table users {
  uid string [pk, note: 'Firebase Auth UID']
  name string
  email string [unique]
  username string [unique]
  birth_date timestamp
  city string
  role string [note: 'pupil | tutor']
  bio text
  avatar_url string
  created_at timestamp
}

Table tutor_profiles {
  uid string [pk, note: 'Document ID = user uid']
  about text [note: 'ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ']
  education string
  experience_years int
  subjects array [note: '["ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°", "Ğ¤Ğ¸Ğ·Ğ¸ĞºĞ°"]']

  // Ğ¦ĞµĞ½Ñ‹ (Ğ² Firestore ÑÑ‚Ğ¾ map)
  price_min float [note: 'ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ½Ğ° (Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ· subject_prices)']
  price_max float [note: 'ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ½Ğ° (Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ· subject_prices)']
  subject_prices_json json [note: 'Map: {"ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°": 1000, "Ğ¤Ğ¸Ğ·Ğ¸ĞºĞ°": 1200}']

  is_online bool [default: false]
  is_offline bool [default: false]
  bank_account string

  // ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
  rating float [note: 'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³']
  total_paid_lessons int [default: 0]
  total_reviews int [default: 0]
  last_paid_lesson_date timestamp
  is_newcomer bool [default: true, note: 'ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ±ĞµĞ¹Ğ´Ğ¶ ğŸ†•']
  last_rating_update timestamp

  created_at timestamp
}

Table slots {
  slot_id string [pk]
  tutor_id string
  date timestamp [note: 'Normalized to 00:00:00']
  start_time string [note: 'Format: "09:00"']
  end_time string [note: 'Format: "10:00"']
  duration_minutes int [default: 60]

  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status string [default: 'available', note: 'available | booked | completed | cancelled']
  is_booked bool [default: false]

  // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸)
  student_id string [null]
  subject string [null, note: 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ¿Ñ€Ğ¸ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸']
  price_per_hour float [null, note: 'Ğ¦ĞµĞ½Ğ° Ğ½Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ±Ñ€Ğ¾Ğ½Ğ¸']
  paid_via_app bool [default: false]
  payment_id string [null]

  created_at timestamp
  booked_at timestamp [null]
  completed_at timestamp [null]
}

Table payments {
  payment_id string [pk]
  slot_id string [unique, note: 'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¾Ñ‚']
  tutor_id string
  pupil_id string
  subject string
  amount float
  status string [default: 'completed', note: 'completed | cancelled']
  payment_method string [default: 'mock_payment', note: 'Ğ”Ğ»Ñ Ğ´Ğ¸Ğ¿Ğ»Ğ¾Ğ¼Ğ°: Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹']

  created_at timestamp
  completed_at timestamp [null]

  Note: '''
  Ğ—ĞĞ§Ğ•Ğœ ĞĞ£Ğ–ĞĞ payments Ğ¿Ñ€Ğ¸ Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹:
  1. Ğ¡Ğ²ÑĞ·ÑŒ "Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ° â†’ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğµ â†’ Ğ¿Ñ€Ğ°Ğ²Ğ¾ Ğ½Ğ° Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³"
  2. Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğ¹ ÑƒÑ‡ĞµĞ½Ğ¸ĞºĞ°
  3. ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ paid_lessons_count (Ğ²ĞµÑ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°)
  4. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ total_paid_lessons Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€Ğ°
  5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° is_verified Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²

  Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ ÑÑĞ´Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑÑ:
  - external_payment_id (ID Ğ¸Ğ· Ğ®Kassa/Stripe)
  - webhook_data (JSON Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°)
  '''
}

Table reviews {
  review_id string [pk]
  tutor_id string
  pupil_id string

  rating int [null, note: '1-5 Ğ·Ğ²Ñ‘Ğ·Ğ´ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ is_verified)']
  comment text
  is_verified bool [default: false, note: 'true ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ½Ğ¾Ğµ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğµ']
  paid_lessons_count int [default: 0, note: 'Ğ’ĞµÑ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°']
  lesson_date timestamp [note: 'Ğ”Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… 6 Ğ¼ĞµÑÑÑ†ĞµĞ²']

  created_at timestamp
  updated_at timestamp

  Indexes {
    (tutor_id, lesson_date) [name: 'tutor_reviews_by_date']
    (pupil_id, tutor_id) [unique, name: 'one_review_per_pupil']
  }
}

Table chats {
  chat_id string [pk, note: 'Format: pupil_uid_tutor_uid (sorted)']
  pupil_id string
  tutor_id string

  // ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
  last_message string
  last_message_type string [note: 'text | image | audio']
  last_sender_id string
  last_timestamp timestamp

  // Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ½ĞµĞ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ…
  unread_count_pupil int [default: 0]
  unread_count_tutor int [default: 0]

  created_at timestamp
}

Table messages {
  message_id string [pk]
  chat_id string [note: 'Ğ Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ñ‡Ğ°Ñ‚ (subcollection Ğ² Firestore)']

  sender_id string
  sender_email string
  receiver_id string

  message text [note: 'Ğ¢ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ URL Ñ„Ğ°Ğ¹Ğ»Ğ°']
  type string [note: 'text | image | audio']
  timestamp timestamp
  is_read bool [default: false]

  // ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
  file_name string [null]
  file_size int [null, note: 'Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ² Ğ±Ğ°Ğ¹Ñ‚Ğ°Ñ…']
  duration int [null, note: 'Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…']
}

Table blocked_users {
  id string [pk]
  user_id string [note: 'ĞšÑ‚Ğ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ»']
  blocked_user_id string [note: 'ĞšĞ¾Ğ³Ğ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸']
  blocked_at timestamp
}


Table reports {
  report_id string [pk]
  reported_by string [note: 'UID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ']
  message_id string
  message_owner_id string
  reason string
  timestamp timestamp
}

// ============================================
// ĞĞŸĞ¦Ğ˜ĞĞĞĞ›Ğ¬ĞĞ«Ğ• Ğ¤Ğ˜Ğ§Ğ˜ (ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ 3)
// ============================================

Table posts {
  post_id string [pk]
  tutor_id string
  title string
  content text
  image_url string [null]
  created_at timestamp

  Note: 'ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ°: Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸/Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¸ĞºĞ¸ Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€Ğ°'
}

// ============================================
// Ğ¡Ğ’Ğ¯Ğ—Ğ˜ (REFERENCES)
// ============================================

// ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€Ğ° Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
Ref: tutor_profiles.uid - users.uid

// Ğ¡Ğ»Ğ¾Ñ‚Ñ‹ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ°Ñ‚ Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€Ñƒ
Ref: slots.tutor_id > users.uid

// Ğ‘Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ ÑƒÑ‡ĞµĞ½Ğ¸ĞºĞ¾Ğ¼
Ref: slots.student_id > users.uid

// ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸
Ref: payments.slot_id - slots.slot_id
Ref: payments.tutor_id > users.uid
Ref: payments.pupil_id > users.uid
Ref: slots.payment_id > payments.payment_id

// ĞÑ‚Ğ·Ñ‹Ğ²Ñ‹
Ref: reviews.tutor_id > users.uid
Ref: reviews.pupil_id > users.uid

// Ğ§Ğ°Ñ‚Ñ‹
Ref: chats.pupil_id > users.uid
Ref: chats.tutor_id > users.uid

// Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (subcollection)
Ref: messages.chat_id > chats.chat_id
Ref: messages.sender_id > users.uid
Ref: messages.receiver_id > users.uid

// Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
Ref: blocked_users.user_id > users.uid
Ref: blocked_users.blocked_user_id > users.uid

// Ğ–Ğ°Ğ»Ğ¾Ğ±Ñ‹
Ref: reports.reported_by > users.uid
Ref: reports.message_id > messages.message_id
Ref: reports.message_owner_id > users.uid

// ĞŸĞ¾ÑÑ‚Ñ‹ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
Ref: posts.tutor_id > users.uid
