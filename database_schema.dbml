// Database Schema –¥–ª—è "–£—á–µ–±–∞ —Ä—è–¥–æ–º"
// Backend: PocketBase (SQLite)
// –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: https://dbdiagram.io/

// ============================================
// –¢–ï–ö–£–©–ò–ï –ö–û–õ–õ–ï–ö–¶–ò–ò (–†–µ–∞–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
// ============================================

Table users {
  id text [pk, note: 'PocketBase Auth Collection ID']
  email text [unique, note: 'Email –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (system field)']
  username text [unique, note: '–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (min:3, max:50)']
  name text [note: '–ü–æ–ª–Ω–æ–µ –∏–º—è (required, max:100)']
  birthDate text [note: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (date field)']
  city text [note: '–ì–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è (max:100)']
  role text [note: '"student" | "tutor" (select field)']
  bio text [note: '–û —Å–µ–±–µ (max:500)']
  avatar text [note: '–ò–º—è —Ñ–∞–π–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞ (file field: jpg/png/gif/webp, max:5MB, thumbs:100x100,300x300)']

  created text [note: 'Auto-generated timestamp']
  updated text [note: 'Auto-generated timestamp']

  Note: '''
  Auth Collection - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è PocketBase
  –ü–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (bcrypt)
  allowEmailAuth: true, minPasswordLength: 8
  '''
}

Table messages {
  id text [pk]
  chatRoomId text [note: 'Format: "uid1_uid2" (min:1, max:100)']
  senderId text [note: 'Relation ‚Üí users.id']
  senderEmail text [note: 'Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (max:200)']
  receiverId text [note: 'Relation ‚Üí users.id']

  message text [note: '–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ URL —Ñ–∞–π–ª–∞ (max:5000)']
  type text [note: '"text" | "image" | "audio" (select field)']
  isRead text [note: 'Boolean field (default: false)']

  created text [note: '–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (auto)']

  Indexes {
    chatRoomId [name: 'idx_chatRoomId']
    senderId [name: 'idx_senderId']
    receiverId [name: 'idx_receiverId']
  }

  Note: '''
  –ë–∞–∑–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
  –§–∞–π–ª—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–∞—É–¥–∏–æ) –ø–æ–∫–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ URL –≤ –ø–æ–ª–µ message
  '''
}

Table slots {
  id text [pk]
  tutorId text [note: 'Relation ‚Üí users.id']
  date text [note: 'Date field, normalized to 00:00:00']
  startTime text [note: 'Format: "HH:MM" (pattern: ^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$)']
  endTime text [note: 'Format: "HH:MM" (pattern: ^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$)']

  isBooked text [note: 'Boolean field (default: false)']
  isPaid text [note: 'Boolean field (default: false)']

  studentId text [null, note: 'Relation ‚Üí users.id (optional)']

  created text
  updated text

  Indexes {
    tutorId [name: 'idx_tutorId']
    date [name: 'idx_date']
  }

  Note: '–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤'
}

Table blocked_users {
  id text [pk]
  userId text [note: 'Relation ‚Üí users.id (cascade delete)']
  blockedUserId text [note: 'Relation ‚Üí users.id (cascade delete)']

  created text

  Indexes {
    (userId, blockedUserId) [unique, name: 'idx_user_blocked']
  }

  Note: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏'
}

Table reports {
  id text [pk]
  reportedBy text [note: 'Relation ‚Üí users.id']
  messageId text [note: 'Relation ‚Üí messages.id (cascade delete)']
  messageOwnerId text [note: 'Relation ‚Üí users.id']

  created text

  Note: '–ñ–∞–ª–æ–±—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö'
}

Table chats {
  id text [pk]
  chatRoomId text [unique, note: 'Format: "uid1_uid2" (alphabetically sorted)']
  user1Id text [note: 'Relation ‚Üí users.id']
  user2Id text [note: 'Relation ‚Üí users.id']

  lastMessage text [null, note: '–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–º–∞–∫—Å 500)']
  lastMessageType text [note: '"text" | "image" | "audio"']
  lastSenderId text [note: 'Relation ‚Üí users.id']
  lastTimestamp text [note: '–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è']

  unreadCountUser1 integer [default: 0]
  unreadCountUser2 integer [default: 0]

  created text
  updated text

  Note: '''
  –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–∞—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–ø–∏—Å–∫–∞ (Two-Table Pattern)

  –†–ï–®–ï–ù–ò–ï: –î–≤–µ —Ç–∞–±–ª–∏—Ü—ã –≤–º–µ—Å—Ç–æ subcollections
  - chats: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –Ω–∞ HomePage)
  - messages: –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏—Å—Ç–æ—Ä–∏—è –≤ ChatPage)

  –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ _createOrUpdateChatRoom() –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
  '''
}

// ============================================
// –ü–õ–ê–ù–ò–†–£–ï–ú–´–ï –ö–û–õ–õ–ï–ö–¶–ò–ò (–î–ª—è –¥–∏–ø–ª–æ–º–∞)
// ============================================

Table tutor_profiles {
  id text [pk]
  userId text [unique, note: 'Relation ‚Üí users.id']
  subjects text [note: 'JSON –º–∞—Å—Å–∏–≤: ["–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–§–∏–∑–∏–∫–∞"]']
  priceMin real [note: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —á–∞—Å']
  priceMax real [note: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —á–∞—Å']
  experience integer [note: '–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –≥–æ–¥–∞—Ö']
  education text [note: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ']
  lessonFormat text [note: 'JSON: ["online", "offline", "both"]']

  rating real [default: 0, note: '–°—Ä–µ–¥–Ω–∏–π –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥']
  totalPaidLessons integer [default: 0]
  lastPaidLessonDate text [null]
  isNewbie integer [default: 1, note: 'Boolean: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–µ–π–¥–∂ üÜï']

  created text
  updated text

  Note: '‚ö†Ô∏è –ü–û–ö–ê –ù–ï –°–û–ó–î–ê–ù–ê - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤'
}

Table payments {
  id text [pk]
  studentId text [note: 'Relation ‚Üí users.id']
  tutorId text [note: 'Relation ‚Üí users.id']
  slotId text [note: 'Relation ‚Üí slots.id']
  amount real [note: '–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã']
  status text [default: 'pending', note: '"pending" | "completed" | "failed"']

  created text

  Note: '‚ö†Ô∏è –ü–û–ö–ê –ù–ï –°–û–ó–î–ê–ù–ê - –ò–º–∏—Ç–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã –¥–ª—è –¥–∏–ø–ª–æ–º–∞'
}

Table reviews {
  id text [pk]
  tutorId text [note: 'Relation ‚Üí users.id']
  studentId text [note: 'Relation ‚Üí users.id']
  rating integer [note: '1-5 –∑–≤—ë–∑–¥ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ isVerified)']
  comment text [null]
  isVerified integer [note: 'Boolean: true –µ—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ']
  lessonId text [null, note: 'Relation ‚Üí slots.id']
  weight integer [note: '–í–µ—Å –æ—Ç–∑—ã–≤–∞ = –∫–æ–ª-–≤–æ –∑–∞–Ω—è—Ç–∏–π']

  created text

  Note: '‚ö†Ô∏è –ü–û–ö–ê –ù–ï –°–û–ó–î–ê–ù–ê - –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤'
}

// ============================================
// –°–í–Ø–ó–ò (REFERENCES)
// ============================================

// –°–ª–æ—Ç—ã
Ref: slots.tutorId > users.id
Ref: slots.studentId > users.id

// –°–æ–æ–±—â–µ–Ω–∏—è
Ref: messages.senderId > users.id
Ref: messages.receiverId > users.id

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏
Ref: blocked_users.userId > users.id
Ref: blocked_users.blockedUserId > users.id

// –ñ–∞–ª–æ–±—ã
Ref: reports.reportedBy > users.id
Ref: reports.messageId > messages.id
Ref: reports.messageOwnerId > users.id

// –ß–∞—Ç—ã (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
Ref: chats.user1Id > users.id
Ref: chats.user2Id > users.id
Ref: chats.lastSenderId > users.id

// === –ü–õ–ê–ù–ò–†–£–ï–ú–´–ï –°–í–Ø–ó–ò ===

// –ü—Ä–æ—Ñ–∏–ª–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ (–∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–¥–∏–º)
Ref: tutor_profiles.userId > users.id

// –ü–ª–∞—Ç–µ–∂–∏ (–∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–¥–∏–º)
Ref: payments.studentId > users.id
Ref: payments.tutorId > users.id
Ref: payments.slotId > slots.id

// –û—Ç–∑—ã–≤—ã (–∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–¥–∏–º)
Ref: reviews.tutorId > users.id
Ref: reviews.studentId > users.id
Ref: reviews.lessonId > slots.id

// ============================================
// –°–¢–ê–¢–£–° –ú–ò–ì–†–ê–¶–ò–ò
// ============================================

// ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ú–ò–ì–†–ò–†–û–í–ê–ù–û:
// - users (Auth Collection)
// - messages (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ + URL —Ñ–∞–π–ª–æ–≤)
// - chats (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤) - Two-Table Pattern ‚úÖ
// - slots (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
// - blocked_users (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
// - reports (–∂–∞–ª–æ–±—ã)

// üîÑ –í –ü–†–û–¶–ï–°–°–ï:
// - –§–∞–π–ª—ã –≤ —á–∞—Ç–∞—Ö (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–∞—É–¥–∏–æ) –∏—Å–ø–æ–ª—å–∑—É—é—Ç Cloudinary
//   TODO: –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PocketBase Storage (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è imageFile, audioFile)

// ‚è≥ –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø –î–õ–Ø –î–ò–ü–õ–û–ú–ê:
// - tutor_profiles (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤)
// - reviews (–æ—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏)
// - payments (–∏–º–∏—Ç–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã)

// ============================================
// –¢–ò–ü–´ –ü–û–õ–ï–ô POCKETBASE
// ============================================
// text - —Å—Ç—Ä–æ–∫–∏, email, username, bio
// date - –¥–∞—Ç—ã (birthDate, —Å–ª–æ—Ç—ã)
// bool - boolean (isRead, isBooked, isPaid)
// select - enum –∑–Ω–∞—á–µ–Ω–∏—è (role, type)
// file - —Ñ–∞–π–ª—ã (avatar)
// relation - —Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
// number - —Ü–µ–ª—ã–µ –∏ –¥—Ä–æ–±–Ω—ã–µ —á–∏—Å–ª–∞ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ)

// JSON –º–∞—Å—Å–∏–≤—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ text: '["item1", "item2"]'
// Boolean –≤ SQLite: true/false (–Ω–µ 0/1!)
// Timestamps: ISO 8601 —Å—Ç—Ä–æ–∫–∏
